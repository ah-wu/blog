<meta name="viewport" content="width=device-width height=device-height initial-scale=1.0
                               minimum-scale=1.0 maximum-scale=1.0 user-scalable=no"/>
<script>
function media(urls,url_end=1){
      let div=document.createElement("div");
      div.style.display="none";
      if(urls==""){
           return div;
      }else{
            urls=urls.split(" ");
            let url=urls.slice(0,url_end).join(" ");
            if(url_end==urls.length){
                 urls=urls.slice(1).join(" ");
                 url_end=1;
            }else{
                 urls=urls.join(" ");
                 url_end=url_end+1;
            }
            fetch(url,{method:"HEAD"}).then(
                function(response){
                    if(response.ok==true){
                         let mda=undefined;
                         let type=response.headers.get("Content-Type");
                         type=type.substr(0,type.indexOf("/"));
                         if(type=="image"){
                              mda=document.createElement("img");
                         }else if(type=="video"||type=="audio"){
                              mda=document.createElement(type);
                              mda.controls=true;
                         }else{
                              /*PASS*/
                         }
                         if(mda!=undefined){
                              mda.src=url;
                              mda.style.width="100%";
                              mda.className="media";
                              mda.onerror=function(){
                                              this.parentNode
                                                  .replaceChild(media(urls,url_end),this);
                                          };
                              div.parentNode
                                 .replaceChild(mda,div);
                         }else{
                              div.parentNode
                                 .replaceChild(media(urls,url_end),div);
                         }
                    }else{
                         div.parentNode
                            .replaceChild(media(urls,url_end),div);
                    }
                 },
                 function(error){
                     div.parentNode
                        .replaceChild(media(urls,url_end),div);
                 });
              return div;
          }
}
function text(str){
    let div=document.createElement("div");
    div.className="text";
    div.style.width="100%";
    div.innerText=str;
    return div;
}
function title(str){
    let button=document.createElement("button");
    button.className="title";
    button.style.width="100%";
    button.style.fontSize="2em";
    button.style.textAlign="center";
    button.style.boxShadow="none";
    button.style.borderStyle="none";
    button.innerText=str;
    button.onclick=function(){
                       let content=this.nextSibling;
                       if(content.style.display==""){
                           content.style.display="none";
                       }else{
                           content.style.display="";
                       }
                   };
    return button;
}
function content(){
    let div=document.createElement("div");
    div.className="content";
    div.style.width="100%";
    return div;
}
function make(id,str){
    let strs=str.split(/\r\n|\r|\n/);
    let node=document.getElementById(id);
    node.innerHTML="";
    node.className="blog";
    for(let x=0; x<strs.length; x=x+1){
        str=strs[x];
        switch(str[0]){
            case "+":
               node.appendChild(media(str.substr(1)));
               break;
            case ">":
               if(node.className=="content"){
                    node=node.parentNode;
               }else{
                    /*PASS*/
               }
               node.appendChild(title(str.substr(1)));
               let snode=content();
               node.appendChild(snode);
               node=snode;
               break;
            case "=":
               str=str.substr(1);
            default:
               node.appendChild(text(str));
         }
     }
     if(node.className=="content"){
         node=node.parentNode;
     }else{
         /*PASS*/
     }
}
</script>
<body>
<textarea oninput="make('sh',this.value)" 
style="width:100%;height:30%;overflow:auto"></textarea>
<div id="sh" ></div>
</body>
