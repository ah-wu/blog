<meta name="viewport" content="width=device-width height=device-height initial-scale=1.0
                               minimum-scale=1.0 maximum-scale=1.0 user-scalable=no"/>
<script>
function view(it,div){
	if(it.style.textAlign=="left"){
		div.style.display="inline-block";
		it.style.textAlign="center";
	}else{
		div.style.display="none";
		it.style.textAlign="left";
	}
}
function format(text){
	/* Unfortunately, the regex expr \r\n|\r is not the same as \r|\r\n */
	let list=text.trim().replaceAll(/\r\n|\r/g,"\n").split(/\n\n/);
	let blogs=document.getElementById("blogs");
	blogs.innerHTML="";
	for(let x=0; x<list.length; x=x+1){
		let div=document.createElement("div");
		let title_begin=0;
		let title_end=list[x].indexOf("\n");
		let content_begin=title_end+1;
		let title=list[x].substr(title_begin,title_end);
		let content=list[x].substr(content_begin);
		div.innerText=content;
		div.innerHTML=`<div id="${x}c" style="display:inline-block;
                                           width:100%;
                                           font-size:0.5em">${div.innerHTML}</div>
                                <button style="display:inline-block;
                                               width:100%;
                                               box-shadow:none;
                                               border-style:none;
                                               font-size:inherit;
					       font-weight:bold;
					       color:rgba(246,235,170,1);
					       background:rgba(173,100,122,1);
					       text-align:center"
                                        onclick="share(document.getElementById('${x}b'))"
                                        ondbclick="alert('Cannot share it')">Share it</button>
				<button style="display:inline-block;
					       width:100%;
					       box-shadow:none;
					       border-style:none;
					       font-size:inherit;
					       font-weight:bold;
					       color:rgba(116,44,157,1);
					       background:rgba(196,181,155,1);
					       text-align:center" 
					onclick="document.getElementById('${x}t').click()" >End of read</button>
				`;
		div.style.display="none";
                div.style.width="100%";
		div.style.background="rgba(0,184,255,1)";
		div.id=`${x}`;
		let pdiv=document.createElement("div");
		pdiv.appendChild(div);
		pdiv.innerHTML=`<br>
                                <button style="display:inline-block;
					       width:100%;
					       box-shadow:none;
					       border-style:none;
					       font-size:inherit;
					       font-weight:bold;
					       color:rgba(227,76,151,1);
					       background:rgba(133,146,0,1);
					       text-align:left" 
					onclick="view(this,document.getElementById('${x}'))" id="${x}t" >${title}</button>
						${pdiv.innerHTML}
				`;
                pdiv.style.display="block";
                pdiv.className="blog";
                pdiv.id=`${x}b`;
                pdiv.dataset.title_id=`${x}t`;
                pdiv.dataset.content_id=`${x}c`;
		blogs.appendChild(pdiv);
	}
}
function read_text(url,func){
	xhr=new XMLHttpRequest();
	xhr.onreadystatechange=function(){
		let DONE=4;
		let OK=200;
		if(this.readyState==DONE){
			if(this.status==OK){
				func(this.responseText);
			}else{
				func(undefined);
			}
		}else{
			/*PASS*/
		}
	};
	xhr.open("GET",url);
	xhr.send();
}
function load_blog(text){
            if(text!=undefined){
                 format(text);
            }else{
                 /*PASS*/
            }
}
function search(srckey){
        let key=document.getElementById("key");
        key.innerText=srckey;
        let blogs=document.getElementsByClassName("blog");
        if(key.innerHTML!=""){
                for(let x=0; x<blogs.length; x=x+1){
                         let title=document.getElementById(blogs[x].dataset.title_id);
                         let content=document.getElementById(blogs[x].dataset.content_id);
                         title.innerHTML=title.innerHTML
                                              .replaceAll(/<[^>]*>/g,"")
                                              .replaceAll(key.innerHTML,"<span style='color:rgba(255,255,255,1)'>$&</span>");
                         content.innerHTML=content.innerHTML
                                                  .replaceAll(/<[^>]*>/g,"")
                                                  .replaceAll(key.innerHTML,"<span style='color:rgba(255,255,255,1)'>$&</span>");
                         if(title.innerHTML.indexOf("<")==-1
                            && content.innerHTML.indexOf("<")==-1){
                               blogs[x].style.display="none";
                         }else{
                               blogs[x].style.display="block";
                         }
                }
         }else{
                for(let x=0; x<blogs.length; x=x+1){
                         let title=document.getElementById(blogs[x].dataset.title_id);
                         let content=document.getElementById(blogs[x].dataset.content_id);
                         title.innerHTML=title.innerHTML
                                              .replaceAll(/<[^>]*>/g,"");
                         content.innerHTML=content.innerHTML
                                                  .replaceAll(/<[^>]*>/g,"");
                         blogs[x].style.display="block";
                 }
         }
}
function share(it){ 
        /* Experimental!!! */
         let title=document.getElementById(it.dataset.title_id);
         let content=document.getElementById(it.dataset.content_id);
         let share_text=`${title.innerText}\n${content.innerText}\nSee more at:\n`;
         navigator.share({title:"Share",
                          text:share_text,
                          url:""});
}
</script>
<body onload="read_text('./blog.txt',load_blog)" 
      style="font-size:2em;
             background:rgba(0,206,0,1);">
<tr>
<input type="search" 
       placeholder="Search in blog" 
       style="font-size:inherit;width:100%;" 
       oninput="search(this.value)"
       onchange="search(this.value)" >
<div id="key" style="display:none"></div>
</tr>
<tr>
<div style="width:100%;height:100%;overflow:auto">
<div id="blogs" style="width:100%;overflow:auto">
<h2 style="text-align:center;
           color:rgba(232,0,0,1)">
      Cannot load blogs if you see me now
</h2>
</div>
<br>
</div>
</tr>
</body>
